# RK-3568 QC 測試系統 - 更新日誌

## 版本 1.3 - 2024年12月

### 🆕 新增功能

#### 1. LCD 背光測試
- **新功能**：添加 LCD 背光亮度控制測試
- **測試流程**：
  1. 設置亮度到最大值
  2. 減半亮度並詢問用戶確認變暗
  3. 重新調亮並詢問用戶確認變亮
  4. 恢復原始亮度設置
- **支援路徑**：`/sys/class/backlight/lvds-backlight/brightness`
- **安全機制**：測試過程中保存並恢復原始亮度

#### 2. 環境檢查增強
- **新增**：LCD 背光系統檢查
- **功能**：
  - 檢查背光控制文件是否存在
  - 驗證背光控制權限
  - 顯示當前和最大亮度值
  - 自動搜尋替代背光路徑

### 📝 文檔更新

#### 1. 測試項目列表更新
- **README_QC.md**：添加 LCD 背光測試說明
- **README_SIMPLE.md**：更新測試項目表格
- **DEPLOYMENT.md**：添加 LCD 硬體要求和故障排除

#### 2. 硬體要求更新
- 新增 LCD 顯示器要求 (支援背光控制)
- 更新硬體連接檢查清單
- 添加 LCD 相關故障排除指南

### 🔧 技術實現

#### 1. LCD 測試函數
```bash
test_lcd() {
    # 檢查背光控制文件
    # 保存當前亮度
    # 執行亮度變化測試
    # 用戶確認測試
    # 恢復原始亮度
}
```

#### 2. 快速測試支援
```bash
test_lcd_quick() {
    # 簡化版 LCD 測試
    # 只測試一次亮度變化
    # 減少等待時間
}
```

### 📊 測試項目更新

| 項目 | 說明 | 互動需求 | 新增版本 |
|------|------|----------|----------|
| 🌐 網路 | 測試 eth0/eth1 連線 | 無 | v1.0 |
| 🔌 GPIO | 測試 GPIO 輸出 | 需確認 LED 亮滅 | v1.0 |
| 🖥️ LCD | 測試 LCD 背光控制 | 需確認亮度變化 | **v1.3** |
| 💾 eMMC | 測試內部存儲 (10MB) | 無 | v1.0 |
| 🔌 USB/SD | 測試外部存儲 (10MB) | 需插入設備 | v1.0 |
| 📡 UART | 測試串口通訊 | 無 | v1.0 |
| 🔄 SPI | 測試 SPI 介面 | 無 | v1.0 |
| 🔗 I2C | 測試 I2C 介面 | 無 | v1.0 |
| ⏰ 時間 | 測試系統時鐘 | 無 | v1.0 |
| ⌨️ 按鍵 | 測試硬體按鍵 (4個) | 需按指定按鍵 | v1.0 |

### 🔧 技術改進

#### 1. 測試工具檢查標準化
- **改進**：將所有腳本中的 `command -v` 統一改為 `which` 命令
- **影響文件**：
  - `qc_test.sh` - UART、SPI、I2C、按鍵測試工具檢查
  - `check_environment.sh` - 必要命令和測試工具檢查
  - `run_qc.sh` - 依賴安裝檢查
- **優點**：
  - 更直觀和標準的工具檢查方式
  - 與用戶記憶中的使用習慣一致
  - 輸出更清晰易懂

### 📁 文件變更清單

#### 修改文件
- `qc_test.sh` - 添加 `test_lcd()` 函數和測試調用，更新工具檢查為 `which`
- `qc_test_quick.sh` - 添加 `test_lcd_quick()` 函數和測試調用
- `check_environment.sh` - 添加 LCD 背光系統檢查，更新工具檢查為 `which`
- `run_qc.sh` - 更新依賴檢查為 `which`
- `README_QC.md` - 更新測試項目和硬體要求
- `README_SIMPLE.md` - 更新測試項目表格
- `START_HERE.md` - 添加 LCD 測試到概覽
- `DEPLOYMENT.md` - 添加 LCD 相關說明和故障排除
- `CHANGELOG.md` - 記錄本次更新 (本文件)

---

## 版本 1.2 - 2024年12月

### 🔧 最新修復

#### 1. eMMC 測試大小優化
- **變更**：eMMC 測試大小從 100MB 進一步減少到 10MB
- **原因**：提高測試速度，減少等待時間
- **影響**：測試時間從約 1-2 分鐘縮短到 10-30 秒

#### 2. USB/SD 卡測試智能等待
- **新功能**：當未檢測到 USB 或 SD 卡時，系統會等待用戶插入
- **特色**：
  - 顯示等待進度條 (最多等待 60 秒)
  - 支援 Ctrl+C 跳過測試
  - 自動檢測設備插入
  - 測試大小也減少到 10MB
- **狀態**：新增 SKIP 狀態用於跳過的測試

**使用示例**：
```
================================
USB/SD卡 測試
================================
檢查 USB 設備...
未檢測到 USB 設備，請插入 USB 設備...
等待 USB 設備 插入 (最多等待 60 秒，按 Ctrl+C 跳過)
等待中... 15/60 秒
✓ 檢測到 USB 設備
測試 USB 讀寫 (10MB)...
✓ USB_TEST: PASS
```

#### 3. 測試結果統計增強
- **新增**：SKIP 狀態支援
- **顯示**：總結中會顯示跳過的測試數量
- **邏輯**：跳過的測試不計入通過或失敗

---

## 版本 1.1 - 2024年12月

### 🔧 主要修復

#### 1. eMMC 測試卡住問題
- **問題**：eMMC 測試在寫入階段卡住不動
- **解決方案**：
  - 添加 60 秒超時控制
  - 減少測試大小從 500MB 到 100MB
  - 添加進度提示和狀態顯示
  - 使用 `status=progress` 參數顯示 dd 進度

#### 2. 深藍色文字可讀性問題
- **問題**：深藍色文字在某些終端上難以看清
- **解決方案**：
  - 將所有腳本中的藍色從 `\033[0;34m` 改為 `\033[1;36m` (亮青色)
  - 影響文件：`qc_test.sh`, `run_qc.sh`, `check_environment.sh`

#### 3. 按鍵測試規格更新
- **問題**：plan.md 更新為 4 個按鍵，但腳本仍為 5 個
- **解決方案**：
  - 更新按鍵測試邏輯，從檢測 5 個改為 4 個按鍵
  - 調整判斷標準：至少檢測到 3 個按鍵事件即可通過
  - 添加設備檢測確認
  - 顯示測試輸出以便調試

### ⚡ 新增功能

#### 1. 快速測試模式
- **新文件**：`qc_test_quick.sh`
- **功能**：
  - 網路測試：只 ping 1 次，10 秒超時
  - GPIO 測試：只測試 4 個 GPIO (5,6,8,13)
  - eMMC 測試：只測試 10MB，30 秒超時
  - 基本命令測試：驗證系統基本功能
  - 設備文件檢查：確認必要設備存在

#### 2. 快速測試支援
- **run_qc.sh** 新增 `--quick` 選項
- **Makefile** 新增 `make quick` 命令
- 測試時間從 2-3 分鐘縮短到 30-60 秒

### 📝 文檔更新

#### 1. 使用說明更新
- **README_SIMPLE.md**：添加快速測試說明
- **START_HERE.md**：更新按鍵測試為 4 個按鍵
- **Makefile**：添加快速測試幫助信息

#### 2. 按鍵測試說明修正
- 所有文檔中的按鍵數量從 5 個更新為 4 個
- 測試流程說明更加清晰
- 添加測試輸出顯示功能

### 🛠️ 技術改進

#### 1. 超時控制機制
```bash
# eMMC 測試超時控制
timeout $timeout_seconds dd if=/dev/zero of=./test_emmc bs=1M count=$test_size conv=fsync status=progress 2>&1

# 超時檢測
if [ $write_exit_code -eq 124 ]; then
    echo "寫入測試超時"
fi
```

#### 2. 按鍵測試智能判斷
```bash
# 計算按鍵事件和設備檢測
key_count=$(echo "$key_output" | grep -c "Presse")
device_detected=$(echo "$key_output" | grep -c "adc-keys\|input")

# 靈活的判斷標準
if [ "$key_count" -ge 3 ] && [ "$device_detected" -gt 0 ]; then
    # 測試通過
fi
```

#### 3. 進度顯示改進
```bash
# 添加進度提示
echo -e "${BLUE}  正在寫入 ${test_size}MB 數據，請稍候...${NC}"

# 使用 dd 的 status=progress 參數
dd ... status=progress 2>&1
```

### 📊 測試時間對比

| 版本 | 測試模式 | eMMC 大小 | USB/SD 大小 | 預估時間 | 適用場景 |
|------|----------|-----------|-------------|----------|----------|
| v1.2 | 完整測試 | 10MB | 10MB | 30-60 秒 | 正式 QC 測試 |
| v1.2 | 快速測試 | 10MB | - | 15-30 秒 | 快速驗證 |
| v1.1 | 完整測試 | 100MB | 50MB | 2-3 分鐘 | 舊版本 |
| v1.0 | 完整測試 | 500MB | 50MB | 5-10 分鐘 | 原始版本 |

### 🎯 使用建議

#### 1. 日常使用
```bash
# 快速驗證系統基本功能
sudo bash run_qc.sh --quick

# 完整 QC 測試
sudo bash run_qc.sh
```

#### 2. 故障排除
```bash
# 檢查環境
sudo bash run_qc.sh --check-only

# 只執行測試
sudo bash run_qc.sh --test-only
```

### 🔄 向後兼容性

- 所有原有功能保持不變
- 原有命令仍然有效
- 新增功能為可選項目
- 文檔同時保留詳細和簡化版本

### 📁 文件變更清單

#### 新增文件
- `qc_test_quick.sh` - 快速測試腳本
- `CHANGELOG.md` - 更新日誌 (本文件)

#### 修改文件
- `qc_test.sh` - 修復 eMMC 測試、顏色、按鍵測試
- `run_qc.sh` - 添加快速測試支援、修復顏色
- `check_environment.sh` - 修復顏色
- `README_SIMPLE.md` - 添加快速測試說明
- `START_HERE.md` - 更新按鍵測試說明
- `Makefile` - 添加快速測試命令

#### 未變更文件
- `plan.md` - 需求規格 (用戶更新)
- `README_QC.md` - 詳細技術文檔
- `DEPLOYMENT.md` - 部署指南
- `prepare_usb.bat` - Windows 準備工具

### 🚀 下一步計劃

1. **性能優化**：進一步優化測試速度
2. **報告格式**：支援 HTML/JSON 格式報告
3. **遠程監控**：添加網路報告功能
4. **配置文件**：將參數提取到配置文件

### 📞 技術支援

如遇問題，請提供：
1. 使用的命令和選項
2. 錯誤訊息或日誌文件
3. 系統環境信息
4. 硬體連接狀態

---

**版本 1.1 主要解決了 eMMC 測試卡住、顏色可讀性和按鍵測試規格更新問題，並新增了快速測試功能。**
